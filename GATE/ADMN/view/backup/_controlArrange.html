<%-include('./top.ejs')%>

      <div class="am-content">
        <div class="page-head">

          <div class="btn-group btn-space" style="float:right;">
            <button class="btn btn-info dropdown-toggle" data-toggle="dropdown"><i class="icon s7-search"></i> 물리 / 논리 구분
            <span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="#"><i class="icon s7-server"></i> 상태 및 이름</a>
              <a class="dropdown-item" href="#"><i class="icon s7-server"></i> 메소드 별</a>
              <a class="dropdown-item" href="#"><i class="icon s7-server"></i> IP:Port</a>
              <!-- <div class="dropdown-divider"></div><a class="dropdown-item" href="#">Separated link</a> -->
            </div>
          </div>

          <h2><span class="icon s7-way"></span> 서버운영</h2>
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/?project=KB_G-Branch">KB G-Branch</a></li>
            <li class="breadcrumb-item"><a href="/control">운영</a></li>
            <li class="breadcrumb-item active">서버운영</li>
          </ol>

        </div>
        <div class="main-content">
          <div class="user-profile">

            <div id="serversCon" class="row">

<!-- 
              <div class="col-lg-4 col-md-12">
                <div class="info-block" style="background:#3d3c3c;color:white;padding:20px 15px;">
                  <a href="/control/server"><button class="btn btn-success btn-xs btn-rounded" style="float:right;">정보보기</button></a>
                  <h4><strong>AP</strong> 물리서버</h4>
                </div>
                <div class="info-block card">
                  <div class="card-body"><span class="description">외부접근용 물리서버, DMZ구간</span>
                    <table class="no-border no-strip skills">
                      <tbody class="no-border-x no-border-y">
                        <tr>
                          <td class="item">IP :<span class="icon s7-portfolio"></span></td>
                          <td>192.168.100.100</td>
                        </tr>
                        <tr>
                          <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                          <td>25, 28, 100~2000, 5000~8000</td>
                        </tr>
                        <tr>
                          <td class="item">OS :<span class="icon s7-usb"></span></td>
                          <td>Linux, CentOS release 6.5 (Final)</td>
                        </tr>
                        <tr>
                          <td class="item">Hardware :<span class="icon s7-phone"></span></td>
                          <td>32G RAM, 200Gb SSD, AMD Ryzen 5th Genration</td>
                        </tr>
                        <tr>
                          <td class="item">Domain :<span class="icon s7-global"></span></td>
                          <td>test.website.com</td>
                        </tr>
                        <tr>
                          <td class="item">관리자 :<span class="icon s7-science"></span></td>
                          <td>박말똥 010-5152-8888</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-lg-4 col-md-12">
                <div class="info-block card" style="border-top:3px solid #aaa;">
                  <div class="card-header">
                    <a href="/control/server"><button class="btn btn-space btn-success btn-xs btn-rounded" style="float:right;">정보보기</button></a>
                    <h4><strong>KBK_GBR_00101SK</strong> 논리서버</h4>
                  </div>
                  <div class="chart-container">
                    <div id="linechart-mini1" style="height: 100px;"></div>
                  </div>
                  <div class="card-body"><span class="description">BIZ - KBK_GBR_00101SK (계좌이체요청)</span>
                    <table class="no-border no-strip skills">
                      <tbody class="no-border-x no-border-y">
                        <tr>
                          <td class="item">App :<span class="icon s7-portfolio"></span></td>
                          <td>App_KBK_GBR_00101SK.js (Source)</td>
                        </tr>
                        <tr>
                          <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                          <td>1200, 1300</td>
                        </tr>
                        <tr>
                          <td class="item">VS :<span class="icon s7-usb"></span></td>
                          <td>3.99</td>
                        </tr>
                        <tr>
                          <td class="item">프로젝트 :<span class="icon s7-phone"></span></td>
                          <td>국민은행 KBK</td>
                        </tr>
                        <tr>
                          <td class="item">개발자 :<span class="icon s7-science"></span></td>
                          <td>박말순 010-5152-8888</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-lg-4 col-md-12">
                <div class="info-block" style="background:#3d3c3c;color:white;padding:20px 15px;">
                  <a href="/control/server"><button class="btn btn-success btn-xs btn-rounded" style="float:right;">정보보기</button></a>
                  <h4><strong>AP</strong> 물리서버</h4>
                </div>
                <div class="info-block card">
                  <div class="card-body"><span class="description">외부접근용 물리서버, DMZ구간</span>
                    <table class="no-border no-strip skills">
                      <tbody class="no-border-x no-border-y">
                        <tr>
                          <td class="item">IP :<span class="icon s7-portfolio"></span></td>
                          <td>192.168.100.100</td>
                        </tr>
                        <tr>
                          <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                          <td>25, 28, 100~2000, 5000~8000</td>
                        </tr>
                        <tr>
                          <td class="item">OS :<span class="icon s7-usb"></span></td>
                          <td>Linux, CentOS release 6.5 (Final)</td>
                        </tr>
                        <tr>
                          <td class="item">Hardware :<span class="icon s7-phone"></span></td>
                          <td>32G RAM, 200Gb SSD, AMD Ryzen 5th Genration</td>
                        </tr>
                        <tr>
                          <td class="item">Domain :<span class="icon s7-global"></span></td>
                          <td>test.website.com</td>
                        </tr>
                        <tr>
                          <td class="item">관리자 :<span class="icon s7-science"></span></td>
                          <td>박말똥 010-5152-8888</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-lg-4 col-md-12">
                <div class="info-block card" style="border-top:3px solid #aaa;">
                  <div class="card-header">
                    <a href="/control/server"><button class="btn btn-space btn-success btn-xs btn-rounded" style="float:right;">정보보기</button></a>
                    <h4><strong>KBK_GBR_00101SK</strong> 논리서버</h4>
                  </div>
                  <div class="chart-container">
                    <div id="barchart-mini1" style="height: 100px;"></div>
                  </div>
                  <div class="card-body"><span class="description">BIZ - KBK_GBR_00101SK (계좌이체요청)</span>
                    <table class="no-border no-strip skills">
                      <tbody class="no-border-x no-border-y">
                        <tr>
                          <td class="item">App :<span class="icon s7-portfolio"></span></td>
                          <td>App_KBK_GBR_00101SK.js (Source)</td>
                        </tr>
                        <tr>
                          <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                          <td>1200, 1300</td>
                        </tr>
                        <tr>
                          <td class="item">VS :<span class="icon s7-usb"></span></td>
                          <td>3.99</td>
                        </tr>
                        <tr>
                          <td class="item">프로젝트 :<span class="icon s7-phone"></span></td>
                          <td>국민은행 KBK</td>
                        </tr>
                        <tr>
                          <td class="item">개발자 :<span class="icon s7-science"></span></td>
                          <td>박말순 010-5152-8888</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-lg-4 col-md-12">
                <div class="info-block" style="background:#3d3c3c;color:white;padding:20px 15px;">
                  <a href="/control/server"><button class="btn btn-success btn-xs btn-rounded" style="float:right;">정보보기</button></a>
                  <h4><strong>AP</strong> 물리서버</h4>
                </div>
                <div class="info-block card">
                  <div class="card-body"><span class="description">외부접근용 물리서버, DMZ구간</span>
                    <table class="no-border no-strip skills">
                      <tbody class="no-border-x no-border-y">
                        <tr>
                          <td class="item">IP :<span class="icon s7-portfolio"></span></td>
                          <td>192.168.100.100</td>
                        </tr>
                        <tr>
                          <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                          <td>25, 28, 100~2000, 5000~8000</td>
                        </tr>
                        <tr>
                          <td class="item">OS :<span class="icon s7-usb"></span></td>
                          <td>Linux, CentOS release 6.5 (Final)</td>
                        </tr>
                        <tr>
                          <td class="item">Hardware :<span class="icon s7-phone"></span></td>
                          <td>32G RAM, 200Gb SSD, AMD Ryzen 5th Genration</td>
                        </tr>
                        <tr>
                          <td class="item">Domain :<span class="icon s7-global"></span></td>
                          <td>test.website.com</td>
                        </tr>
                        <tr>
                          <td class="item">관리자 :<span class="icon s7-science"></span></td>
                          <td>박말똥 010-5152-8888</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-lg-4 col-md-12">
                <div class="info-block" style="background:#3d3c3c;color:white;padding:20px 15px;">
                  <a href="/control/server"><button class="btn btn-success btn-xs btn-rounded" style="float:right;">정보보기</button></a>
                  <h4><strong>AP</strong> 물리서버</h4>
                </div>
                <div class="info-block card">
                  <div class="card-body"><span class="description">외부접근용 물리서버, DMZ구간</span>
                    <table class="no-border no-strip skills">
                      <tbody class="no-border-x no-border-y">
                        <tr>
                          <td class="item">IP :<span class="icon s7-portfolio"></span></td>
                          <td>192.168.100.100</td>
                        </tr>
                        <tr>
                          <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                          <td>25, 28, 100~2000, 5000~8000</td>
                        </tr>
                        <tr>
                          <td class="item">OS :<span class="icon s7-usb"></span></td>
                          <td>Linux, CentOS release 6.5 (Final)</td>
                        </tr>
                        <tr>
                          <td class="item">Hardware :<span class="icon s7-phone"></span></td>
                          <td>32G RAM, 200Gb SSD, AMD Ryzen 5th Genration</td>
                        </tr>
                        <tr>
                          <td class="item">Domain :<span class="icon s7-global"></span></td>
                          <td>test.website.com</td>
                        </tr>
                        <tr>
                          <td class="item">관리자 :<span class="icon s7-science"></span></td>
                          <td>박말똥 010-5152-8888</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
 -->

            </div>
          </div>

          <pre id="debug">cfg <%-JSON.stringify(cfg,null,6)%></pre>

        </div>
      </div>

<%-include('./down.ejs')%>


    <script src="/assets/lib/jquery-flot/jquery.flot.js" type="text/javascript"></script>
    <script src="/assets/lib/jquery-flot/jquery.flot.pie.js" type="text/javascript"></script>
    <script src="/assets/lib/jquery-flot/jquery.flot.time.js" type="text/javascript"></script>
    <script src="/assets/lib/jquery-flot/jquery.flot.resize.js" type="text/javascript"></script>
    <script src="/assets/lib/jquery-flot/plugins/jquery.flot.orderBars.js" type="text/javascript"></script>
    <script src="/assets/lib/jquery-flot/plugins/curvedLines.js" type="text/javascript"></script>
    <script src="/assets/lib/jquery-flot/plugins/jquery.flot.tooltip.js" type="text/javascript"></script>
    <script src="/assets/lib/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/assets/js/app-pages-profile.js" type="text/javascript"></script>

<script type="text/javascript">
menuActive({
  src:'<%=src%>',
  dir:'<%=dir%>'
});

//////////////////////////////////////
const GQ=JSON.parse('<%-JSON.stringify(GQ)%>');
const cfg=JSON.parse('<%-JSON.stringify(cfg)%>');

//////////////////////////////////////
let servers=[];
let appRun={};
let ordMchN=ordAppN=0;
//console.log(cfg.apps.mach);

for(let i in cfg.appRun.apps){
  let run=cfg.appRun.apps[i];
  //console.log(run.name);
  appRun[run.name]=run;
}

for(let machName in cfg.apps.mach){
  let info=cfg.apps.mach[machName];
  //console.log(machName);
  ordMchN++;
  cfg.apps.mach[machName].ordMchN=String(ordMchN).padStart(2,'0');
  servers.push({
    type:'mach',
    name:machName,
    order:String(ordMchN).padStart(2,'0'),
    info:info
  });
}

let gateName=cfg.apps.gate.name;
let gateInfo=cfg.apps.gate;
gateInfo=Object.assign(gateInfo,appRun[gateName]);
//console.log(gateName);
ordAppN++;
servers.push({
  type:'gate',
  name:gateName,
  order:cfg.apps.mach[gateInfo.machName].ordMchN+'|'+String(ordAppN).padStart(2,'0'),
  info:gateInfo
});

for(let key in cfg.apps.bizs){
  let info=cfg.apps.bizs[key];
  info=Object.assign(info,appRun[info.name]);
  //console.log(info.name);
  ordAppN++;
  servers.push({
    type:'biz',
    name:info.name,
    order:cfg.apps.mach[info.machName].ordMchN+'|'+String(ordAppN).padStart(2,'0'),
    info:info
  });
}

for(let ctrlName in cfg.apps.ctrl){
  let info=cfg.apps.ctrl[ctrlName];
  info=Object.assign(info,appRun[ctrlName]);
  //console.log(ctrlName);
  ordAppN++;
  servers.push({
    type:'ctrl',
    name:ctrlName,
    order:cfg.apps.mach[info.machName].ordMchN+'|'+String(ordAppN).padStart(2,'0'),
    info:info
  });
}

for(let demoName in cfg.apps.demo){
  let info=cfg.apps.demo[demoName];
  info=Object.assign(info,appRun[demoName]);
  //console.log(demoName);
  ordAppN++;
  servers.push({
    type:'demo',
    name:demoName,
    order:cfg.apps.mach[info.machName].ordMchN+'|'+String(ordAppN).padStart(2,'0'),
    info:info
  });
}

servers=sortAryByKey(servers,'order');
console.log(servers);

let servStr='';
for(let k in servers){
  let serv=servers[k];
  let type=serv.type;
  let info=serv.info;
  if(type=='mach' && GQ.type!='app'){
    servStr+=`
    <div class="col-lg-4 col-md-12">
      <div class="info-block" style="background:#3d3c3c;color:white;padding:20px 15px;">
        <button class="machServerPageBtn btn btn-success btn-xs btn-rounded" data-machname="${serv.name}" style="float:right;">정보보기</button>
        <h4><strong>${serv.name}</strong> (물리서버)</h4>
      </div>
      <div class="info-block card">
        <div class="card-body"><span class="description">${info.machMemo}</span>
          <table class="no-border no-strip skills">
            <tbody class="no-border-x no-border-y">
              <tr>
                <td class="item">IP :<span class="icon s7-portfolio"></span></td>
                <td>외부: ${info.machIpOut}<br>내부: ${info.machIpIn}</td>
              </tr>
              <!-- <tr>
                <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                <td>25, 28, 100~2000, 5000~8000</td>
              </tr> -->
              <tr>
                <td class="item">OS :<span class="icon s7-usb"></span></td>
                <td>Linux, CentOS release 6.5 (Final)</td>
              </tr>
              <tr>
                <td class="item">Hardware :<span class="icon s7-phone"></span></td>
                <td>32G RAM, 200Gb SSD, AMD Ryzen 5th Genration</td>
              </tr>
              <tr>
                <td class="item">Domain :<span class="icon s7-global"></span></td>
                <td>${info.machDomain}</td>
              </tr>
              <tr>
                <td class="item">관리자 :<span class="icon s7-science"></span></td>
                <td>${info.admin}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>`;
  }
  else if(GQ.type!='mach'){
/*
name: "07.BIZ3_webSocket"
order: "2.WAS_SERVER|07.BIZ3_webSocket"
type: "biz"
info:
  appDiv: "biz"
  appMemo: "비지니스 서버 (HTTP WEB SOCKET)"
  appPort: 1103
  autostart: true
  limitCnt: 200
  machName: "2.WAS_SERVER"
  method: "ND_METH_TEST3"
  name: "07.BIZ3_webSocket"
  node_args: "--max-old-space-size=8192"
  restart_delay: 1000
  script: "C:/NodeBreaker/95/2_DMZ/BIZS/07.BIZ3.js"
  host:
    domain: "localhost"
    ip: "222.108.224.3"
    method: "WS"
    methodCom: "ND_METH_TEST3"
    path: "/"
    port: 1203
    proto: "ws"
*/
    let portHtml=mthHtml=hostHtml='';
    if(info.appPort) portHtml=`
              <tr>
                <td class="item">Port :<span class="icon s7-map-marker"></span></td>
                <td>${info.appPort}</td>
              </tr>`;
    if(cfg.appNmToMth[serv.name]) mthHtml=`
              <tr>
                <td class="item">Method :<span class="icon s7-filter"></span></td>
                <td>${cfg.appNmToMth[serv.name]}</td>
              </tr>`;
    if(serv.type=='biz' && info.host) hostHtml=`
              <tr>
                <td class="item">Target Host :<span class="icon s7-target"></span></td>
                <td>
                proto: ${info.host.proto.toUpperCase()}<br>
                method: ${info.host.method}<br>
                domain: ${info.host.domain}<br>
                ip: ${info.host.ip}<br>
                port: ${info.host.port}<br>
                path: ${info.host.path}<br>
                methodCom: ${info.host.methodCom}<br>
                </td>
              </tr>`;
    servStr+=`
    <div class="col-lg-4 col-md-12">
      <div class="info-block card" style="border-top:3px solid #aaa;">
        <div class="card-header">
          <button class="appServerPageBtn btn btn-space btn-success btn-xs btn-rounded" data-appname="${serv.name}" style="float:right;">정보보기</button>
          <span style="font-size:12px;"><strong>${info.machName}</strong> (물리)</span>
          <h4>> <strong>${serv.name}</strong> (논리서버)</h4>
        </div>
        <div class="card-body"><span class="description">${info.appMemo}</span>
        <div class="chart-container" style="background:#ddd;height:100px;text-align:cetner;">
          <!-- <div id="linechart-mini1" style="height: 100px;"></div> -->
        </div>
          <table class="no-border no-strip skills">
            <tbody class="no-border-x no-border-y">
              <tr>
                <td class="item">App :<span class="icon s7-portfolio"></span></td>
                <td>${info.script} (Source)</td>
              </tr>
              `+portHtml+`
              `+mthHtml+`
              `+hostHtml+`
              <!-- <tr>
                <td class="item">VS :<span class="icon s7-usb"></span></td>
                <td>3.99</td>
              </tr> -->
              <tr>
                <td class="item">프로젝트 :<span class="icon s7-phone"></span></td>
                <td>${cfg.apps.proName}<br>${cfg.apps.proMemo}</td>
              </tr>
              <tr>
                <td class="item">개발자 :<span class="icon s7-science"></span></td>
                <td>${info.admin}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>`;
  }
}

$('#serversCon').html(servStr);

$('.appServerPageBtn').click(function(){
  document.location.href='/control/server?appName='+$(this).data('appname');
});
$('.machServerPageBtn').click(function(){
  document.location.href='/stat/machine?machName='+$(this).data('machname');
});





//$(document).ready(function(){
  //- initialize the javascript
  App.init();
  //App.pageProfile();
//});

</script>
</body>
</html>